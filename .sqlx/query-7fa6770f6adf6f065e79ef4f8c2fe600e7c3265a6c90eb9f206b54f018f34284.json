{
  "db_name": "SQLite",
  "query": "WITH\nsource_platform AS (\n    SELECT\n        account_platforms.*\n    FROM account_platform_data\n    INNER JOIN account_platforms ON\n        account_platform_data.platform = account_platforms.id AND\n        account_platforms.platform = 'bungie'\n    WHERE account_platform_data.key = 'unique_name'\n    AND account_platform_data.value = ?\n    ORDER BY account_platforms.updated_at DESC\n    LIMIT 1\n),\ndiscord_data AS (\n    SELECT\n        source_platform.account,\n        discord_platforms.id AS platform,\n        displayname_data.value AS display_name,\n        username_data.value AS username\n    FROM source_platform\n    INNER JOIN account_platforms AS discord_platforms ON\n        source_platform.account = discord_platforms.account  AND\n        discord_platforms.platform = 'discord'\n    INNER JOIN account_platform_data AS displayname_data ON\n        discord_platforms.id = displayname_data.platform AND\n        displayname_data.key = 'display_name'\n    INNER JOIN account_platform_data AS username_data ON\n        discord_platforms.id = username_data.platform AND\n        username_data.key = 'username'\n),\nbungie_data AS (\n    SELECT\n        source_platform.account AS account,\n        membership_data.platform AS platform,\n        membership_data.value AS display_name\n    FROM source_platform\n    INNER JOIN account_platform_data AS membership_data ON\n        source_platform.id = membership_data.platform AND\n        source_platform.account = membership_data.account AND\n        membership_data.key = 'unique_name'\n),\ntwitch_data AS (\n    SELECT\n        account_platforms.account AS account,\n        membership_data.platform AS platform,\n        membership_data.value AS display_name\n    FROM source_platform\n    INNER JOIN account_platforms ON\n        source_platform.account = account_platforms.account AND\n        account_platforms.platform = 'twitch'\n    INNER JOIN account_platform_data AS membership_data ON\n        account_platforms.id = membership_data.platform AND\n        account_platforms.account = membership_data.account AND\n        membership_data.key = 'display_name'\n)\nSELECT\n    accounts.token AS account_token,\n    discord_data.username AS username,\n    discord_data.display_name AS discord,\n    bungie_data.display_name AS bungie,\n    COALESCE(twitch_data.display_name, '') AS twitch\nFROM source_platform\nINNER JOIN accounts ON source_platform.account = accounts.id\nINNER JOIN bungie_data ON\n    accounts.id = bungie_data.account AND\n    source_platform.id = bungie_data.platform\nINNER JOIN discord_data ON accounts.id = discord_data.account\nLEFT JOIN twitch_data ON accounts.id = twitch_data.account",
  "describe": {
    "columns": [
      {
        "name": "account_token",
        "ordinal": 0,
        "type_info": "Text"
      },
      {
        "name": "username",
        "ordinal": 1,
        "type_info": "Text"
      },
      {
        "name": "discord",
        "ordinal": 2,
        "type_info": "Text"
      },
      {
        "name": "bungie",
        "ordinal": 3,
        "type_info": "Text"
      },
      {
        "name": "twitch",
        "ordinal": 4,
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Right": 1
    },
    "nullable": [
      false,
      false,
      false,
      false,
      false
    ]
  },
  "hash": "7fa6770f6adf6f065e79ef4f8c2fe600e7c3265a6c90eb9f206b54f018f34284"
}
